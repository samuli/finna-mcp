{
  "name": "Finna MCP Server",
  "version": "2.0.0",
  "description": "Suomen kirjastojen, museoiden ja arkistojen yhteinen hakupalvelu. Finna kokoaa satojen toimijoiden aineistot yhteen.",
  "tools": [
    {
      "name": "search_records",
      "description": "Hae tietueita Finnasta. Palauttaa kirjoja, äänilevyjä, videoita, kuvia ja muita aineistoja.",
      "inputSchema": {
        "type": "object",
        "properties": {
          "lookfor": {
            "type": "string",
            "description": "Hakusanat. Esim: 'Tuntematon sotilas', 'Väinö Linna', 'scifi'. Jätä tyhjäksi hakeaksesi kaikkea."
          },
          "filters": {
            "type": "object",
            "description": "Rajoita hakua. Rakenne: {\"include\": {}, \"exclude\": {}, \"any\": {}}",
            "properties": {
              "include": {
                "type": "object",
                "description": "Vaatii että kaikki nämä ehdot täyttyvät",
                "properties": {
                  "format": {
                    "type": "array",
                    "items": {"type": "string"},
                    "description": "Aineistotyyppi. Esimerkkejä: ['0/Book/'], ['0/Sound/'], ['0/Video/'], ['0/Image/'], ['0/Book/eBook/']"
                  },
                  "language": {
                    "type": "array",
                    "items": {"type": "string"},
                    "description": "Kielirajoitus. Esimerkkejä: ['fin'], ['eng'], ['swe']"
                  },
                  "building": {
                    "type": "array",
                    "items": {"type": "string"},
                    "description": "Kirjasto/organisaatio. Hae arvot list_organizations-työkalulla. Esim: ['0/Helmet/'], ['0/SATAKIRJASTOT/']"
                  },
                  "year": {
                    "type": "array",
                    "items": {"type": "string"},
                    "description": "UUSI: Julkaisuvuosi. Esim: ['2026'], ['2025'], ['2020-2025']"
                  }
                }
              },
              "exclude": {
                "type": "object",
                "description": "Poissulje nämä",
                "properties": {
                  "format": {
                    "type": "array",
                    "items": {"type": "string"}
                  },
                  "language": {
                    "type": "array",
                    "items": {"type": "string"}
                  },
                  "building": {
                    "type": "array",
                    "items": {"type": "string"}
                  }
                }
              },
              "any": {
                "type": "object",
                "description": "Vähintään yksi näistä täyttyy (OR-logiikka)",
                "properties": {
                  "format": {
                    "type": "array",
                    "items": {"type": "string"}
                  },
                  "language": {
                    "type": "array",
                    "items": {"type": "string"}
                  },
                  "building": {
                    "type": "array",
                    "items": {"type": "string"}
                  }
                }
              }
            }
          },
          "facets": {
            "type": "array",
            "items": {"type": "string"},
            "description": "Fasetit jotka palautetaan. Esimerkkejä: ['format'], ['building'], ['language'], ['author'], ['genre']. Tyhjä = ei fasetteja."
          },
          "facetFilters": {
            "type": "array",
            "items": {"type": "string"},
            "description": "Rajoita fasetteja (ei vaikuta tietueisiin). Esim: ['building:\\\"0/Helmet/\\\"', 'format:\\\"0/Book/\\\"']"
          },
          "sort": {
            "type": "string",
            "enum": ["relevance", "newest", "oldest", "year_newest", "year_oldest"],
            "default": "relevance",
            "description": "Järjestys: 'relevance' (oletus), 'newest' (viimeksi lisätty), 'oldest', 'year_newest' (uusin julkaisuvuosi), 'year_oldest'"
          },
          "limit": {
            "type": "number",
            "minimum": 0,
            "maximum": 100,
            "default": 20,
            "description": "Tulosten määrä per sivu (0-100). Käytä 0 laskeaksesi vain osumien määrän."
          },
          "page": {
            "type": "number",
            "minimum": 1,
            "default": 1,
            "description": "Sivunumero. Ensimmäinen sivu = 1."
          },
          "fields_preset": {
            "type": "string",
            "enum": ["compact", "media", "full"],
            "description": "Kenttien esivalinta: 'compact' (id, title, urls), 'media' (+ kuvat, resurssit), 'full' (kaikki metadata)"
          },
          "fields": {
            "type": "array",
            "items": {"type": "string"},
            "description": "Tarkat kentät. Ohittaa fields_preset:in. Yleisiä: ['id', 'title', 'authors', 'year', 'formats', 'buildings', 'languages', 'images', 'onlineUrls', 'recordUrl', 'summary']"
          },
          "search_mode": {
            "type": "string",
            "enum": ["simple", "advanced"],
            "default": "simple",
            "description": "'advanced' = monisanaiset haut AND/OR-logiikalla"
          },
          "advanced_operator": {
            "type": "string",
            "enum": ["AND", "OR"],
            "default": "AND",
            "description": "Operaattori advanced-moodissa"
          },
          "sampleLimit": {
            "type": "number",
            "description": "Rajoita resurssien määrää per tietue"
          },
          "lng": {
            "type": "string",
            "default": "fi",
            "description": "Käyttöliittymän kieli: 'fi', 'sv', 'en'"
          }
        }
      },
      "outputSchema": {
        "type": "object",
        "description": "PARANNELTU: Palauttaa sekä metatiedot että tietueet",
        "properties": {
          "resultCount": {
            "type": "number",
            "description": "Osumien kokonaismäärä"
          },
          "records": {
            "type": "array",
            "description": "UUSI: Tietueet. Sisältö riippuu fields_preset/fields-parametrista",
            "items": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "string",
                  "description": "KORJATTU: Tietueen ID. Käytä get_record/extract_resources-kutsuihin."
                },
                "title": {
                  "type": "string"
                },
                "authors": {
                  "type": "array",
                  "items": {"type": "string"}
                },
                "year": {
                  "type": "string"
                },
                "formats": {
                  "type": "array",
                  "items": {"type": "string"}
                },
                "buildings": {
                  "type": "array",
                  "items": {"type": "string"}
                },
                "languages": {
                  "type": "array",
                  "items": {"type": "string"}
                },
                "images": {
                  "type": "array"
                },
                "onlineUrls": {
                  "type": "array"
                },
                "recordUrl": {
                  "type": "string"
                },
                "summary": {
                  "type": "string"
                }
              }
            }
          },
          "facets": {
            "type": "object",
            "description": "Fasetit jos pyydettiin"
          }
        }
      },
      "examples": [
        {
          "description": "Hae kaikki vuonna 2026 ilmestyneet kirjat Satakirjastoista",
          "input": {
            "filters": {
              "include": {
                "format": ["0/Book/"],
                "building": ["0/SATAKIRJASTOT/"],
                "year": ["2026"]
              }
            },
            "sort": "year_newest",
            "limit": 50
          }
        },
        {
          "description": "Hae Beatles-äänilevyjä",
          "input": {
            "lookfor": "Beatles",
            "filters": {
              "include": {
                "format": ["0/Sound/"]
              }
            },
            "limit": 20
          }
        },
        {
          "description": "Laske kuinka monta Agatha Christie -kirjaa on",
          "input": {
            "lookfor": "Agatha Christie",
            "filters": {
              "include": {
                "format": ["0/Book/"]
              }
            },
            "limit": 0
          }
        },
        {
          "description": "Hae suomen- tai ruotsinkielisiä tietokirjoja",
          "input": {
            "lookfor": "historia",
            "filters": {
              "any": {
                "language": ["fin", "swe"]
              }
            },
            "sort": "year_newest",
            "limit": 30
          }
        }
      ]
    },
    {
      "name": "list_organizations",
      "description": "Listaa kirjastot, museot ja arkistot. TÄRKEÄÄ: Käytä tätä ensin hakeaksesi building-arvot search_records-työkaluun.",
      "inputSchema": {
        "type": "object",
        "properties": {
          "lookfor": {
            "type": "string",
            "description": "Etsi organisaatiota nimellä. Esim: 'Pori', 'Helsinki', 'Satakirjastot'"
          },
          "compact": {
            "type": "boolean",
            "default": false,
            "description": "true = vain päätason organisaatiot ilman aliorganisaatioita"
          },
          "include_paths": {
            "type": "boolean",
            "default": false,
            "description": "true = lisää polku (esim. 'Satakirjastot / Pori / Porin pääkirjasto')"
          },
          "max_depth": {
            "type": "number",
            "minimum": 1,
            "maximum": 6,
            "description": "Hierarkian maksimisyvyys (1-6)"
          },
          "lng": {
            "type": "string",
            "default": "fi",
            "description": "Kieli: 'fi', 'sv', 'en'"
          }
        }
      },
      "outputSchema": {
        "type": "object",
        "description": "PARANNELTU: Palauttaa organisaatiot ja niiden value-arvot",
        "properties": {
          "count": {
            "type": "number",
            "description": "Organisaatioiden määrä"
          },
          "organizations": {
            "type": "array",
            "description": "UUSI: Organisaatiot listattuna",
            "items": {
              "type": "object",
              "properties": {
                "value": {
                  "type": "string",
                  "description": "Organisaation tunniste. TÄRKEÄ: Käytä tätä search_records building-filttereissä. Esim: '0/Helmet/', '0/SATAKIRJASTOT/'"
                },
                "translated": {
                  "type": "string",
                  "description": "Nimi valitulla kielellä"
                },
                "path": {
                  "type": "string",
                  "description": "Koko polku (jos include_paths=true)"
                },
                "children": {
                  "type": "array",
                  "description": "Aliorganisaatiot"
                }
              }
            }
          }
        }
      },
      "examples": [
        {
          "description": "Etsi Porin kirjastoa",
          "input": {
            "lookfor": "Pori",
            "include_paths": true
          },
          "output": {
            "count": 6,
            "organizations": [
              {
                "value": "0/SATAKIRJASTOT/",
                "translated": "Satakirjastot",
                "path": "Satakirjastot"
              },
              {
                "value": "0/SATAKIRJASTOT/Pori/",
                "translated": "Porin kaupunginkirjasto",
                "path": "Satakirjastot / Pori"
              }
            ]
          }
        },
        {
          "description": "Listaa kaikki päätason organisaatiot",
          "input": {
            "compact": true
          }
        }
      ]
    },
    {
      "name": "get_record",
      "description": "Hae yksityiskohtaiset tiedot yhdestä tai useammasta tietueesta ID:n perusteella. Käytä search_records:in palauttamia ID:itä.",
      "inputSchema": {
        "type": "object",
        "properties": {
          "ids": {
            "type": "array",
            "items": {"type": "string"},
            "required": true,
            "description": "Tietueiden ID:t. Saat nämä search_records-työkalusta."
          },
          "fields_preset": {
            "type": "string",
            "enum": ["compact", "media", "full"],
            "default": "full",
            "description": "Kenttien määrä"
          },
          "fields": {
            "type": "array",
            "items": {"type": "string"},
            "description": "Tarkat kentät"
          },
          "includeRawData": {
            "type": "boolean",
            "default": false,
            "description": "Sisällytä raaka lähdedata (suuri, käytä vain tarvittaessa)"
          },
          "sampleLimit": {
            "type": "number",
            "description": "Rajoita resurssien määrää"
          },
          "lng": {
            "type": "string",
            "default": "fi"
          }
        },
        "required": ["ids"]
      },
      "examples": [
        {
          "description": "Hae yhden tietueen täydelliset tiedot",
          "input": {
            "ids": ["helmet.123456"],
            "fields_preset": "full"
          }
        },
        {
          "description": "Hae useamman tietueen perustiedot",
          "input": {
            "ids": ["helmet.123456", "helmet.789012"],
            "fields": ["id", "title", "authors", "year", "summary"]
          }
        }
      ]
    },
    {
      "name": "extract_resources",
      "description": "Hae tietueen ulkoiset resurssit (verkkolinkit, e-aineistot, digitoidut versiot). Käytä search_records:in palauttamia ID:itä.",
      "inputSchema": {
        "type": "object",
        "properties": {
          "ids": {
            "type": "array",
            "items": {"type": "string"},
            "required": true,
            "description": "Tietueiden ID:t"
          },
          "sampleLimit": {
            "type": "number",
            "description": "Rajoita esimerkkien määrää per tietue"
          },
          "lng": {
            "type": "string",
            "default": "fi"
          }
        },
        "required": ["ids"]
      },
      "examples": [
        {
          "description": "Hae tietueen verkkolinkit",
          "input": {
            "ids": ["helmet.123456"]
          }
        }
      ]
    }
  ],
  "commonFormats": {
    "description": "Yleisimmät format-arvot. Käytä näitä search_records filters.include.format-parametrissa.",
    "formats": [
      {
        "value": "0/Book/",
        "description": "Kirjat (kaikki)"
      },
      {
        "value": "0/Book/eBook/",
        "description": "E-kirjat"
      },
      {
        "value": "0/Book/BookSection/",
        "description": "Kirjan osat/luvut"
      },
      {
        "value": "0/Sound/",
        "description": "Äänilevyt ja äänikirjat"
      },
      {
        "value": "0/Video/",
        "description": "Videot ja elokuvat"
      },
      {
        "value": "0/Image/",
        "description": "Kuvat ja valokuvat"
      },
      {
        "value": "0/Map/",
        "description": "Kartat"
      },
      {
        "value": "0/Article/",
        "description": "Artikkelit"
      },
      {
        "value": "0/Journal/",
        "description": "Lehdet"
      },
      {
        "value": "0/PhysicalObject/",
        "description": "Fyysiset esineet (museo-objektit)"
      }
    ]
  },
  "commonLanguages": {
    "description": "Yleisimmät kielikoodit. Käytä näitä search_records filters-parametrissa.",
    "languages": [
      {"code": "fin", "name": "Suomi"},
      {"code": "eng", "name": "Englanti"},
      {"code": "swe", "name": "Ruotsi"},
      {"code": "ger", "name": "Saksa"},
      {"code": "fre", "name": "Ranska"},
      {"code": "rus", "name": "Venäjä"},
      {"code": "spa", "name": "Espanja"},
      {"code": "ita", "name": "Italia"}
    ]
  },
  "usagePatterns": {
    "description": "Tyypillisiä käyttötapoja",
    "patterns": [
      {
        "task": "Etsi tietyn kirjaston uutuuksia",
        "steps": [
          "1. Kutsu list_organizations hakeaksesi kirjaston value-arvon (esim. '0/SATAKIRJASTOT/')",
          "2. Kutsu search_records filtterillä: filters.include.building=['0/SATAKIRJASTOT/'], sort='newest'"
        ]
      },
      {
        "task": "Etsi tietyn vuoden kirjoja",
        "steps": [
          "1. Kutsu search_records filtterillä: filters.include.year=['2026'], filters.include.format=['0/Book/']"
        ]
      },
      {
        "task": "Laske tietyn kirjailijan teosten määrä",
        "steps": [
          "1. Kutsu search_records: lookfor='Kirjailija Nimi', limit=0",
          "2. Lue resultCount-arvo"
        ]
      },
      {
        "task": "Hae tarkemmat tiedot kiinnostavista teoksista",
        "steps": [
          "1. Kutsu search_records fields=['id', 'title'] saadaksesi ID:t",
          "2. Kutsu get_record ids=[...] saadaksesi täydelliset tiedot"
        ]
      }
    ]
  },
  "criticalFixes": {
    "description": "KRIITTISET korjaukset edelliseen versioon",
    "fixes": [
      {
        "priority": "CRITICAL",
        "issue": "ID-kentät eivät palautuneet search_records-tuloksissa",
        "fix": "Varmista että 'id'-kenttä palautetaan aina kun sitä pyydetään fields- tai fields_preset-parametrilla"
      },
      {
        "priority": "HIGH",
        "issue": "building-filtteri ei toiminut filters.include.building-parametrissa",
        "fix": "Korjaa building-filtterin toiminta. Testaa että filters.include.building=['0/SATAKIRJASTOT/'] rajaa tuloksia oikein"
      },
      {
        "priority": "HIGH",
        "issue": "Ei tapaa rajata vuoden mukaan",
        "fix": "Lisää year-kenttä filters-parametriin. Tue muotoja: ['2026'], ['2020-2025']"
      },
      {
        "priority": "MEDIUM",
        "issue": "Vastaukset sisälsivät vain metatiedot, ei tietueita",
        "fix": "Palauta records-array joka sisältää tietueiden datan, ei vain 'X hits Y returned' -tekstiä"
      },
      {
        "priority": "MEDIUM",
        "issue": "list_organizations palautti vain lukumäärän",
        "fix": "Palauta organizations-array joka sisältää value, translated, path-kentät"
      },
      {
        "priority": "LOW",
        "issue": "Puutteellinen dokumentaatio",
        "fix": "Lisää runsaasti esimerkkejä description-kenttiin. Dokumentoi yleisimmät format- ja building-arvot"
      }
    ]
  }
}
